<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Flutter 应用适配（自适应布局组件实践）"><meta name="keywords" content="应用适配"><meta name="author" content="Joker"><meta name="copyright" content="Joker"><title>Flutter 应用适配（自适应布局组件实践） | Joker's Blog</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="/css/iconfont.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Android"><span class="toc-number">1.</span> <span class="toc-text">Android</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ConstraintLayout"><span class="toc-number">1.1.</span> <span class="toc-text">1. ConstraintLayout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-替代布局"><span class="toc-number">1.2.</span> <span class="toc-text">2. 替代布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Fragment"><span class="toc-number">1.3.</span> <span class="toc-text">3. Fragment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-矢量图"><span class="toc-number">1.4.</span> <span class="toc-text">4. 矢量图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS"><span class="toc-number">2.</span> <span class="toc-text">iOS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Auto-Layout"><span class="toc-number">2.1.</span> <span class="toc-text">1. Auto Layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Size-类"><span class="toc-number">2.2.</span> <span class="toc-text">2. Size 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-UI-组件"><span class="toc-number">2.3.</span> <span class="toc-text">3. UI 组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flutter"><span class="toc-number">3.</span> <span class="toc-text">Flutter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flutter-适配组件"><span class="toc-number">4.</span> <span class="toc-text">Flutter 适配组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MediaQuery"><span class="toc-number">4.1.</span> <span class="toc-text">1. MediaQuery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-LayoutBuilder"><span class="toc-number">4.2.</span> <span class="toc-text">2. LayoutBuilder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-OrientationBuilder"><span class="toc-number">4.3.</span> <span class="toc-text">3. OrientationBuilder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Expanded-和-Flexible"><span class="toc-number">4.4.</span> <span class="toc-text">4. Expanded 和 Flexible</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-FractionallySizedBox"><span class="toc-number">4.5.</span> <span class="toc-text">5. FractionallySizedBox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-AspectRatio"><span class="toc-number">4.6.</span> <span class="toc-text">6. AspectRatio</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用开发实践"><span class="toc-number">5.</span> <span class="toc-text">应用开发实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主页"><span class="toc-number">5.1.</span> <span class="toc-text">主页</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聊天页面"><span class="toc-number">6.</span> <span class="toc-text">聊天页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下一步"><span class="toc-number">7.</span> <span class="toc-text">下一步</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.jpg"></div><div class="author-info__name text-center">Joker</div><div class="author-info__description text-center">分享生活感悟、技术、学习心得</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">46</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">43</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Joker's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">目录</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Flutter 应用适配（自适应布局组件实践）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-11-05</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/flutter/">flutter</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>本文翻译自：<a href="https://medium.com/flutter-community/demystifying-responsive-layout-in-flutter-f85d0014b94e" target="_blank" rel="noopener">Demystifying responsive layout in Flutter</a>，作者：Souvik Biswas，已获作者授权，译文首次发表于微信公众号「Meandni」，<a href="https://mp.weixin.qq.com/s/15JMvjuGKkZaq2WEvxlsSQ" target="_blank" rel="noopener">点击阅读</a>。</p>
</blockquote>
<p>Flutter 作为现如今应用如此广泛的跨平台开发框架，当然支持各种设备下屏幕的适配。</p>
<p>而当前，<strong>我们的应用也完全能运行在小如手表，大如电视的设备中</strong>，要实现这么多场景下的适配始终是一个挑战，但 Flutter 或许就能做到。</p>
<p>在 Flutter 中，设计响应式布局没有官方的硬性规定及标准。本文会向读者们展示设计自适应布局时可以遵循的一些方法。</p>
<h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><p>在介绍 Flutter 的屏幕适配方案之前，我想先简单说一下在原生 Android 和 iOS 下如何处理不同屏幕尺寸的布局，Android 主要有如下几种方式。</p>
<h3 id="1-ConstraintLayout"><a href="#1-ConstraintLayout" class="headerlink" title="1. ConstraintLayout"></a>1. ConstraintLayout</h3><p><strong>ConstraintLayout (约束布局)</strong> 是 Android 支持的一种功能强大的布局组件，主要功能就是可以灵活地响应不同的手机屏幕尺寸，根据组件间的关系确定各个组件的位置和大小，这其实和 Flutter 内的布局约束概念有点类似。</p>
<blockquote>
<p>详情可以参考 ConstraintLayout 官方文档：<strong><a href="https://developer.android.com/training/constraint-layout?hl=zh-cn" target="_blank" rel="noopener">https://developer.android.com/training/constraint-layout?hl=zh-cn</a></strong></p>
</blockquote>
<p>但约束布局也不能解决多种设备的适配场景，因为它只能适应性的调整 UI 组件的大小，长宽，这么做其实并不优雅，而且在写运行在手表之类的屏幕很小的设备上，只调整大小也会使界面看起来给非常奇怪。</p>
<h3 id="2-替代布局"><a href="#2-替代布局" class="headerlink" title="2. 替代布局"></a>2. 替代布局</h3><p>要解决上述问题，我们可以尝试针对不同大小的设备使用各不相同的布局文件。例如，可以在平板电脑等设备中实现左右<strong>视图分离</strong>，从而充分利用大屏幕下宽敞的屏幕宽度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*zT0i-H9I9kmbnt81e6yFug-20201105212906223.png" alt=""></p>
<p>在 Android 中，开发者可以为不同的屏幕尺寸定义<strong>单独的布局文件</strong>，并且 Android 底层也会根据设备的屏幕尺寸自动处理这些布局之间的切换。</p>
<h3 id="3-Fragment"><a href="#3-Fragment" class="headerlink" title="3. Fragment"></a>3. Fragment</h3><p>合理使用 Fragment，我们可以将 UI 逻辑单独抽离到特定的 Fragment 中，这样在为大屏幕设备设计布局时就可以有效地复用这些逻辑了。</p>
<h3 id="4-矢量图"><a href="#4-矢量图" class="headerlink" title="4. 矢量图"></a>4. 矢量图</h3><p>矢量图一般由 XML 创建，可以直接定义可配置的 Path 和颜色，相比像素位 bitmaps 更加灵活且高效，在不同尺寸的屏幕下也可以无限放大而不失真。Android 平台中，可以使用 <a href="https://developer.android.com/guide/topics/graphics/vector-drawable-resources" target="_blank" rel="noopener">VectorDrawable</a> 类定义矢量图。</p>
<h2 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h2><p>iOS 下，我们可以使用下面几种方式实现屏幕适配。</p>
<h3 id="1-Auto-Layout"><a href="#1-Auto-Layout" class="headerlink" title="1. Auto Layout"></a>1. Auto Layout</h3><p>Auto Layout 可以用来在 iOS 平台下构建可适配 UI，我们可以在其中定义控制应用程序内容的规则（或称为<strong>约束</strong>），当在处于某些条件（或者<strong>特征</strong>）时，Auto Layout 就会根据指定的约束条件自动重新调整布局。</p>
<h3 id="2-Size-类"><a href="#2-Size-类" class="headerlink" title="2. Size 类"></a>2. Size 类</h3><p>Size 类表示根据其大小自动分配给内容区域的特征。这种情况下，iOS 就可以根据内容区域的大小类别动态地进行布局调整。在 iPad 上，当应用处于 multitasking 的配置中运行时，Size 类同样适用。</p>
<h3 id="3-UI-组件"><a href="#3-UI-组件" class="headerlink" title="3. UI 组件"></a>3. UI 组件</h3><p>在 iOS 上也原生提供了一些天然自适应的 UI 组件，如 <a href="https://developer.apple.com/documentation/uikit/uistackview" target="_blank" rel="noopener">UIStackView</a>，<a href="https://developer.apple.com/documentation/uikit/uiviewcontroller" target="_blank" rel="noopener">UIViewController </a>和 <a href="https://developer.apple.com/documentation/uikit/uisplitviewcontroller" target="_blank" rel="noopener">UISplitViewController</a>。</p>
<h2 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h2><p>即使我们不是 Android 或 iOS 开发人者，现在也应该大致熟悉了这两个平台如何处理自适应布局的一些方法了。</p>
<p>在 Android 中，要在单个屏幕上显示多个 UI 视图，建议使用 <strong>Fragment</strong>，它就相当于在 Activity 中可重用的组件。</p>
<blockquote>
<p>在 Android 中，Activity 即代表一个页面，一个 Activity 中可以运行多个 Fragment，但同一个应用下，同时只展示一个 Activity。</p>
</blockquote>
<p>在 iOS 中，要控制多个视图控制器（View Controllers），可以使用 UISplitViewController，它在分层界面中可以管理子视图控制器。</p>
<p>而 Flutter 中天然就存在 “<strong>一切皆为 Widget</strong>” 的概念，整个应用程序也基本都是由 Widget 组合而成的。并且<strong>每个 Widget 都是可以复用的</strong>，因此，想要在 Flutter 中实现屏幕自适应的布局，不需要学习其他任何概念，下面介绍的这些 Widget 应该足够你使用了！</p>
<h2 id="Flutter-适配组件"><a href="#Flutter-适配组件" class="headerlink" title="Flutter 适配组件"></a>Flutter 适配组件</h2><p>如前所诉，在 Flutter 我们只需要掌握一些 Widget 即可，实际的开发过程中，我们也只需要在合适的地方使用它们即可。下面，我们就一起来看看这些组件分别有什么魔力。</p>
<h3 id="1-MediaQuery"><a href="#1-MediaQuery" class="headerlink" title="1. MediaQuery"></a>1. MediaQuery</h3><p>我要介绍的第一个 Widget 即是 MediaQuery，通过它可以直接获得屏幕的<strong>大小（宽度 / 高度）和方向（纵向 / 横向）</strong>。如下这个示例：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    Size screenSize = MediaQuery.of(context).size;</span><br><span class="line">    Orientation orientation = MediaQuery.of(context).orientation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Container(</span><br><span class="line">        color: CustomColors.android,</span><br><span class="line">        child: Center(</span><br><span class="line">          child: Text(</span><br><span class="line">            <span class="string">'View\n\n'</span> +</span><br><span class="line">                <span class="string">'[MediaQuery width]: <span class="subst">$&#123;screenSize.width.toStringAsFixed(<span class="number">2</span>)&#125;</span>\n\n'</span> +</span><br><span class="line">                <span class="string">'[MediaQuery orientation]: <span class="subst">$orientation</span>'</span>,</span><br><span class="line">            style: TextStyle(color: Colors.white, fontSize: <span class="number">18</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*pHVt1lSp1ohJwnixNCCd6Q.png" alt=""></p>
<h3 id="2-LayoutBuilder"><a href="#2-LayoutBuilder" class="headerlink" title="2. LayoutBuilder"></a>2. LayoutBuilder</h3><p>使用 LayoutBuilder 组件，可以获得一个 <a href="https://api.flutter.dev/flutter/rendering/BoxConstraints-class.html" target="_blank" rel="noopener">BoxConstraints</a> 对象，通过该对象我们就可以拿到 Widget 的 <strong>maxWidth（最大宽度）</strong> 和 <strong>maxHeight（最大高度）</strong></p>
<blockquote>
<p>MediaQuery 和 LayoutBuilder 的区别在在于，MediaQuery 得到的是整个屏幕的宽高，而 LayoutBuilder 得到的是特定组件的最大高度和宽度。</p>
</blockquote>
<p>如下这个示例：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    Size screenSize = MediaQuery.of(context).size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Row(</span><br><span class="line">        children: [</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">2</span>,</span><br><span class="line">            child: LayoutBuilder(</span><br><span class="line">              builder: (context, constraints) =&gt; Container(</span><br><span class="line">                color: CustomColors.android,</span><br><span class="line">                child: Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'View 1\n\n'</span> +</span><br><span class="line">                        <span class="string">'[MediaQuery]:\n <span class="subst">$&#123;screenSize.width.toStringAsFixed(<span class="number">2</span>)&#125;</span>\n\n'</span> +</span><br><span class="line">                        <span class="string">'[LayoutBuilder]:\n<span class="subst">$&#123;constraints.maxWidth.toStringAsFixed(<span class="number">2</span>)&#125;</span>'</span>,</span><br><span class="line">                    style: TextStyle(color: Colors.white, fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">3</span>,</span><br><span class="line">            child: LayoutBuilder(</span><br><span class="line">              builder: (context, constraints) =&gt; Container(</span><br><span class="line">                color: Colors.white,</span><br><span class="line">                child: Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'View 2\n\n'</span> +</span><br><span class="line">                        <span class="string">'[MediaQuery]:\n <span class="subst">$&#123;screenSize.width.toStringAsFixed(<span class="number">2</span>)&#125;</span>\n\n'</span> +</span><br><span class="line">                        <span class="string">'[LayoutBuilder]:\n<span class="subst">$&#123;constraints.maxWidth.toStringAsFixed(<span class="number">2</span>)&#125;</span>'</span>,</span><br><span class="line">                    style: TextStyle(color: CustomColors.android, fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-14-2020-11-05-1*kpWUG3BylH9VVBgI4tI9wQ.png" alt=""></p>
<h3 id="3-OrientationBuilder"><a href="#3-OrientationBuilder" class="headerlink" title="3. OrientationBuilder"></a>3. OrientationBuilder</h3><p>要确定当前 Widget 的方向，可以使用 OrientationBuilder 组件。<strong>这里的方向与 MediaQuery 提供的设备方向不同</strong>。如下这个示例：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    Orientation deviceOrientation = MediaQuery.of(context).orientation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Column(</span><br><span class="line">        children: [</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">2</span>,</span><br><span class="line">            child: Container(</span><br><span class="line">              color: CustomColors.android,</span><br><span class="line">              child: OrientationBuilder(</span><br><span class="line">                builder: (context, orientation) =&gt; Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'View 1\n\n'</span> +</span><br><span class="line">                        <span class="string">'[MediaQuery orientation]:\n<span class="subst">$deviceOrientation</span>\n\n'</span> +</span><br><span class="line">                        <span class="string">'[OrientationBuilder]:\n<span class="subst">$orientation</span>'</span>,</span><br><span class="line">                    style: TextStyle(color: Colors.white, fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">3</span>,</span><br><span class="line">            child: OrientationBuilder(</span><br><span class="line">              builder: (context, orientation) =&gt; Container(</span><br><span class="line">                color: Colors.white,</span><br><span class="line">                child: Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'View 2\n\n'</span> +</span><br><span class="line">                        <span class="string">'[MediaQuery orientation]:\n<span class="subst">$deviceOrientation</span>\n\n'</span> +</span><br><span class="line">                        <span class="string">'[OrientationBuilder]:\n<span class="subst">$orientation</span>'</span>,</span><br><span class="line">                    style: TextStyle(color: CustomColors.android, fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*nuUQeXMjzQ8IPRPyGn5n1w.png" alt=""></p>
<h3 id="4-Expanded-和-Flexible"><a href="#4-Expanded-和-Flexible" class="headerlink" title="4. Expanded 和 Flexible"></a>4. Expanded 和 Flexible</h3><p>Expanded 和 Flexible 这两个组件可以和 Column/Row 搭配使用，来实现非常完美的自适应效果。 Expanded 可以用来拓展 Row, 、Column 和 Flex，从而让子组件填充可用空间，Flexible 功能类似但并不一定能填充全部可用空间。</p>
<p>下面这个例子演示了混合使用 Expanded 和 Flexible 的各种方式：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Colors.white,</span><br><span class="line">      body: SafeArea(</span><br><span class="line">        child: Column(</span><br><span class="line">          children: [</span><br><span class="line">            Row(</span><br><span class="line">              children: [</span><br><span class="line">                ExpandedWidget(),</span><br><span class="line">                FlexibleWidget(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              children: [</span><br><span class="line">                ExpandedWidget(),</span><br><span class="line">                ExpandedWidget(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              children: [</span><br><span class="line">                FlexibleWidget(),</span><br><span class="line">                FlexibleWidget(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              children: [</span><br><span class="line">                FlexibleWidget(),</span><br><span class="line">                ExpandedWidget(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExpandedWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Expanded(</span><br><span class="line">      child: Container(</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: CustomColors.android,</span><br><span class="line">          border: Border.all(color: Colors.white),</span><br><span class="line">        ),</span><br><span class="line">        child: Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">          child: Text(</span><br><span class="line">            <span class="string">'Expanded'</span>,</span><br><span class="line">            style: TextStyle(color: Colors.white, fontSize: <span class="number">24</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlexibleWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Flexible(</span><br><span class="line">      child: Container(</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: CustomColors.androidAccent,</span><br><span class="line">          border: Border.all(color: Colors.white),</span><br><span class="line">        ),</span><br><span class="line">        child: Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">          child: Text(</span><br><span class="line">            <span class="string">'Flexible'</span>,</span><br><span class="line">            style: TextStyle(color: CustomColors.android, fontSize: <span class="number">24</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*CWOTNVvLVwDkqQ_FRDS3Nw.png" alt=""></p>
<h3 id="5-FractionallySizedBox"><a href="#5-FractionallySizedBox" class="headerlink" title="5. FractionallySizedBox"></a>5. FractionallySizedBox</h3><p>FractionallySizedBox 组件可以使子组件<strong>填充部分可用空间</strong>，该特性在 Expanded 或 Flexible 中特别有用。示例如下：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Colors.white,</span><br><span class="line">      body: SafeArea(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">          children: [</span><br><span class="line">            Row(</span><br><span class="line">              crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">              children: [</span><br><span class="line">                FractionallySizedWidget(widthFactor: <span class="number">0.4</span>),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">              children: [</span><br><span class="line">                FractionallySizedWidget(widthFactor: <span class="number">0.6</span>),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">              children: [</span><br><span class="line">                FractionallySizedWidget(widthFactor: <span class="number">0.8</span>),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Row(</span><br><span class="line">              crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">              children: [</span><br><span class="line">                FractionallySizedWidget(widthFactor: <span class="number">1.0</span>),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FractionallySizedWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> widthFactor;</span><br><span class="line">  FractionallySizedWidget(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.widthFactor&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Expanded(</span><br><span class="line">      child: FractionallySizedBox(</span><br><span class="line">        alignment: Alignment.centerLeft,</span><br><span class="line">        widthFactor: widthFactor,</span><br><span class="line">        child: Container(</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            color: CustomColors.android,</span><br><span class="line">            border: Border.all(color: Colors.white),</span><br><span class="line">          ),</span><br><span class="line">          child: Padding(</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">            child: Text(</span><br><span class="line">              <span class="string">'<span class="subst">$&#123;widthFactor * <span class="number">100</span>&#125;</span>%'</span>,</span><br><span class="line">              style: TextStyle(color: Colors.white, fontSize: <span class="number">24</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*xcbW24iB2NZOAt6Hc_zzJg.png" target="_blank" rel="noopener"></a></p>
<h3 id="6-AspectRatio"><a href="#6-AspectRatio" class="headerlink" title="6. AspectRatio"></a>6. AspectRatio</h3><p>AspectRatio 组件可以直接<strong>指定子组件的固定宽高比例</strong>，使用时，我们可以使用布局约束的最大宽度，并给定一个宽高比自适应其高度，如下示例：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Colors.white,</span><br><span class="line">      body: SafeArea(</span><br><span class="line">        child: Column(</span><br><span class="line">          children: [</span><br><span class="line">            AspectRatioWidget(ratio: <span class="string">'16 / 9'</span>),</span><br><span class="line">            AspectRatioWidget(ratio: <span class="string">'3 / 2'</span>),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AspectRatioWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> ratio;</span><br><span class="line"></span><br><span class="line">  AspectRatioWidget(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.ratio&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> AspectRatio(</span><br><span class="line">      aspectRatio: Fraction.fromString(ratio).toDouble(),</span><br><span class="line">      child: Container(</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: CustomColors.android,</span><br><span class="line">          border: Border.all(color: Colors.white),</span><br><span class="line">        ),</span><br><span class="line">        child: Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">          child: Center(</span><br><span class="line">            child: Text(</span><br><span class="line">              <span class="string">'AspectRatio - <span class="subst">$ratio</span>'</span>,</span><br><span class="line">              style: TextStyle(color: Colors.white, fontSize: <span class="number">24</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-2020-11-05-1*GzI_jmKrNQXMFA8JdBGrRA.png" target="_blank" rel="noopener"></a></p>
<p>下面，我们就可以利用上面介绍的组件实现一个实际的应用了。</p>
<h2 id="应用开发实践"><a href="#应用开发实践" class="headerlink" title="应用开发实践"></a>应用开发实践</h2><p>在这个过程中，即可实现 Flutter 中的视图分离，如下示例图所示，我们要开发的应用名为 <strong>Flow</strong> ，是一款聊天应用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*DivvZvw1LjtOUdkeIzSiPw-20201105154223662.png" alt=""></p>
<p>Flow 主要包括如下两个页面：</p>
<ul>
<li><strong>首页</strong>（<code>PeopleView</code>，<code>BookmarkView</code>，<code>ContactView</code>）</li>
<li><strong>聊天页面</strong>（<code>PeopleView</code>，<code>ChatView</code>）</li>
</ul>
<h3 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h3><p>应用启动时，首页展示 HomePage，该 Widget 主要有如下两个视图：</p>
<ul>
<li><strong>HomeViewSmall</strong>（包括 <code>AppBar</code>，<code>Drawer</code>，<code>BottomNavigationBar</code> 和 <code>DestinationView</code>）</li>
<li><strong>HomeViewLarge</strong>（由拆分视图组组成，<code>MenuWidget</code> ＆<code>DestinationView</code>）</li>
</ul>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _currentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: LayoutBuilder(</span><br><span class="line">        builder: (context, constraints) &#123;</span><br><span class="line">          <span class="keyword">if</span> (constraints.maxWidth &lt; <span class="number">600</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> HomeViewSmall();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> HomeViewLarge();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，使用 LayoutBuilder 得到了组件的 <code>maxWidth</code> ，并通过该值在页面中展示两个不同的组件，<code>HomeViewSmall</code> 和 <code>HomeViewLarge</code>。</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeViewSmallState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeViewSmall</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _currentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">      ),</span><br><span class="line">      drawer: Drawer(</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">      ),</span><br><span class="line">      bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">      ),</span><br><span class="line">      body: IndexedStack(</span><br><span class="line">        index: _currentIndex,</span><br><span class="line">        children: allDestinations.map&lt;Widget&gt;((Destination destination) &#123;</span><br><span class="line">          <span class="keyword">return</span> DestinationView(destination);</span><br><span class="line">        &#125;).toList(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>IndexedStack</code> 和 <code>DestinationView</code> 两个组件主要用来根据用户点击 <code>BottomNavigationBar</code> 做页面切换的动作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*qrUoiEQSB7ALyjBFhM-GdQ-20201105154252319.png" alt=""></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeViewLargeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeViewLarge</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Row(</span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">        children: [</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">2</span>,</span><br><span class="line">            child: MenuWidget(</span><br><span class="line">              selectedIndex: _index,</span><br><span class="line">              onTapped: (selectedIndex) &#123;</span><br><span class="line">                setState(() &#123;</span><br><span class="line">                  _index = selectedIndex;</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">3</span>,</span><br><span class="line">            child: IndexedStack(</span><br><span class="line">              index: _index,</span><br><span class="line">              children: allDestinations.map&lt;Widget&gt;((Destination destination) &#123;</span><br><span class="line">                <span class="keyword">return</span> DestinationView(destination);</span><br><span class="line">              &#125;).toList(),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于大屏幕，应用可以展示包含 <code>MenuWidget</code> 和 <code>DestinationView</code> 两个组件的拆分视图。在 Flutter 中，实现拆分视图特别简单，只需要并排将组件放入 Row 中即可，如果需要填充剩余控件，可以使用 Expanded 包裹这两个组件，我们可以通过指定 Expanded 的 flex 属性分别设置两个组件所占比例（flex 属性默认为 1，即两个组件各一半），上面代码设置比例为 1：3。</p>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*4ISs69dvgcFSqTXlXJKt2A-20201105154314644.png" alt=""></p>
<p>当然，如果此时你打开其他页面，然后返回，页面原有状态将会丢失，也就是说始终返回默认展示的页面，即 <strong>Chats</strong>，要解决此问题，可以使用回调函数指定页面返回至 <code>HomePage</code>，当然，最好可以使用合适的状态管理方案，因为本文主要目的是构建响应式布局，这里我们暂且不设计状态管里的延伸，我们可以做下面这些修改。</p>
<p>修改 <code>HomeViewSmall</code>：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeViewSmall</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> currentIndex;</span><br><span class="line">  <span class="comment">/// <span class="markdown">Callback function</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Function</span>(<span class="built_in">int</span> selectedIndex) onTapped;</span><br><span class="line">  HomeViewSmall(<span class="keyword">this</span>.currentIndex, <span class="keyword">this</span>.onTapped);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomeViewSmallState createState() =&gt; _HomeViewSmallState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeViewSmallState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeViewSmall</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _currentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _currentIndex = widget.currentIndex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        currentIndex: _currentIndex,</span><br><span class="line">        onTap: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            _currentIndex = index;</span><br><span class="line">            <span class="comment">// Invoking the callback</span></span><br><span class="line">            widget.onTapped(_currentIndex);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        items: allDestinations.map((Destination destination) &#123;</span><br><span class="line">          <span class="keyword">return</span> BottomNavigationBarItem(</span><br><span class="line">            icon: Icon(destination.icon),</span><br><span class="line">            label: destination.title,</span><br><span class="line">          );</span><br><span class="line">        &#125;).toList(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 <code>HomeViewLarge</code>：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeViewLarge</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> currentIndex;</span><br><span class="line">  <span class="comment">/// <span class="markdown">Callback function</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Function</span>(<span class="built_in">int</span> selectedIndex) onTapped;</span><br><span class="line">  HomeViewLarge(<span class="keyword">this</span>.currentIndex, <span class="keyword">this</span>.onTapped);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomeViewLargeState createState() =&gt; _HomeViewLargeState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeViewLargeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeViewLarge</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _index = widget.currentIndex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Row(</span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">        children: [</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">2</span>,</span><br><span class="line">            child: MenuWidget(</span><br><span class="line">              selectedIndex: _index,</span><br><span class="line">              onTapped: (selectedIndex) &#123;</span><br><span class="line">                setState(() &#123;</span><br><span class="line">                  _index = selectedIndex;</span><br><span class="line">                  <span class="comment">// Invoking the callback</span></span><br><span class="line">                  widget.onTapped(_index);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 <code>HomePage</code>：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomePageState createState() =&gt; _HomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _currentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: LayoutBuilder(</span><br><span class="line">        builder: (context, constraints) &#123;</span><br><span class="line">          <span class="keyword">if</span> (constraints.maxWidth &lt; <span class="number">600</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> HomeViewSmall(_currentIndex, (index) &#123;</span><br><span class="line">              setState(() &#123;</span><br><span class="line">                _currentIndex = index;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> HomeViewLarge(_currentIndex, (index) &#123;</span><br><span class="line">              setState(() &#123;</span><br><span class="line">                _currentIndex = index;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，可适应组件 HomePage 就已完成。</p>
<h2 id="聊天页面"><a href="#聊天页面" class="headerlink" title="聊天页面"></a>聊天页面</h2><p>ChatPage 与 HomePage 类似，包含如下两个组件：</p>
<ul>
<li><strong>ChatViewSmall</strong>（由 <code>AppBar</code>，<code>ChatList</code>＆<code>SendWidget</code> 组成）</li>
<li><strong>ChatViewLarge</strong>（由 <code>PeopleView</code>，<code>ChatList</code>＆<code>SendWidget</code> 组成）</li>
</ul>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChatPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Color profileIconColor;</span><br><span class="line">  ChatPage(<span class="keyword">this</span>.profileIconColor);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: OrientationBuilder(</span><br><span class="line">        builder: (context, orientation) =&gt; LayoutBuilder(</span><br><span class="line">          builder: (context, constraints) &#123;</span><br><span class="line">            <span class="built_in">double</span> breakpointWidth = orientation == Orientation.portrait ? <span class="number">600</span> : <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (constraints.maxWidth &lt; breakpointWidth) &#123;</span><br><span class="line">              <span class="keyword">return</span> ChatViewSmall(profileIconColor);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> ChatViewLarge(profileIconColor);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，我们使用了 <code>OrientationBuilder</code> 搭配 <code>LayoutBuilder</code>，<code>breakpointWidth</code> 适应当前方向的更改，此时， <code>PeopleView</code> 在小屏幕设备下不展示，如下代码：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChatViewSmall</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Color profileIconColor;</span><br><span class="line">  ChatViewSmall(<span class="keyword">this</span>.profileIconColor);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        color: Colors.white,</span><br><span class="line">        child: Column(</span><br><span class="line">          children: [</span><br><span class="line">            Expanded(child: ChatList(profileIconColor)),</span><br><span class="line">            SendWidget(),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-1*nsTtnyUTeYJFsPliKSbwkw.png" alt=""></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChatViewLarge</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Color profileIconColor;</span><br><span class="line">  ChatViewLarge(<span class="keyword">this</span>.profileIconColor);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Row(</span><br><span class="line">        children: [</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">2</span>,</span><br><span class="line">            child: SingleChildScrollView(</span><br><span class="line">              child: PeopleView(),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">3</span>,</span><br><span class="line">            child: Container(</span><br><span class="line">              color: Colors.white,</span><br><span class="line">              child: Column(</span><br><span class="line">                children: [</span><br><span class="line">                  Expanded(child: ChatList(profileIconColor)),</span><br><span class="line">                  SendWidget(),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/meandni/blogimg@main/img/2020-11-05-2020-11-05-1*eutMMZXnblIqH5CyuOlb1A.png" alt=""></p>
<h2 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h2><p>我们已经使用 Flutter 成功开发出了一个具有屏幕适配功能的应用了，读者们也可以在此基础上继续完善，例如定义根据屏幕尺寸适配不同的 fontsize 等等。所有示例代码：<a href="https://github.com/sbis04/responsive_design，" target="_blank" rel="noopener">https://github.com/sbis04/responsive_design，</a></p>
<p><strong>关注公众号「Meandni」，及时阅读最新前沿技术动态，不至于落后时代。</strong></p>
<p><img alt="扫一扫，关注「Meandni」" src="/images/qrcode_for_small.jpg" style="zoom:50%;" /></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Joker</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://meandni.com/2020/11/05/demystifying-responsive-layout-in-flutter/">https://meandni.com/2020/11/05/demystifying-responsive-layout-in-flutter/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://meandni.com">Joker's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BA%94%E7%94%A8%E9%80%82%E9%85%8D/">应用适配</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/wechat.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ebb714f13e60e34" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/11/14/android-2020/"><i class="fa fa-chevron-left">  </i><span>细数 2020 年官方对 Android 的重大更新</span></a></div><div class="next-post pull-right"><a href="/2020/11/04/obfuscating-the-flutter-app/"><span>Flutter 应用混淆（包体积优化实践）</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '12faa9d04b92d2d70968',
  clientSecret: 'ad1023eebffeb2972301ce0e730e0c277f64cf23',
  repo: 'MeandNi.github.io',
  owner: 'MeandNi',
  admin: 'MeandNi',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2020 By Joker</div><div class="framework-info"><span>驱动 - </span><a href="#"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>